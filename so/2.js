function search(){var s=$("#s-txt"),i=$("#box"),t=($("#box ul li"),$(".search-icon"));t.css("opacity","1");var e,o=-1,a=0,l=0,c=0,r="",u={id:0,name:"百度",url:"https://www.baidu.com/s?wd=",img:"url('https://cdn.miguyu.com/statics/search/baidu.png')"};function p(e){return $(e).contents().filter(function(e,t){return 3===t.nodeType}).text().trim()}function d(t,n){var e;if("https://search.jd.com/Search?keyword="===u.url?(e="https://search.jd.com/Search?keyword="+t+"&enc=utf-8",e="https://union-click.jd.com/jdc?type=union&p=JF8BAGoKGloXVAEBVFdYOE8nAl8JKx9KBVhdDxxtUQ5SQmQWBR1TGxlZAUEPVhcnUWwJT1wSDgFWVwpdDUpHAmYPGFkSVQMLVlxbDk5CVjg4RB9IADYBVV5bAU0fAm0KK2sVXDYyZG5tOEonM184&t=W1dCFBBFC0RUQUpADgpQTFs=&e=&tu=#targetUrl".replace("#targetUrl",encodeURIComponent(e)),window.open(e)):"https://www.baidu.com/s?wd="==u.url&&s_devi_is?(window.open("https://www.baidu.com/s?ie=utf-8&wd="+encodeURIComponent(t)),1==s_stat_tj&&$.get("/count_se/mfind_9999",function(e,t){})):window.open(u.url+encodeURIComponent(t)),1===n&&0<cur_max_his){n=localStorage.getItem("searchText");let e=[];n&&(e=JSON.parse(n)),e.push(t),function(n){for(let t=0;t<n.length;t++){var e=n[t].trim();if(""==e&&n.splice(t,1),""!==e)for(let e=t+1;e<n.length;e++)n[t]==n[e]&&n.splice(t,1)}}(e),10<e.length&&e.splice(0,1),localStorage.setItem("searchText",JSON.stringify(e))}}function n(e){$.ajax({type:"GET",url:"https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su","async":!0,data:{wd:e},dataType:"jsonp",jsonp:"cb",success:function(t){if(c=0,$("#box ul").text(""),a=t.s.length,o=-1,a){i.css("display","block");for(let e=0;e<a;e++)$("#box ul").append("<li><i class='fa fa-search'></i> "+t.s[e]+"</li>"),$("#box ul li").eq(e).click(function(){var e=p(this);s.val(e),d(e,1),i.css("display","none")}),0===e&&$("#box ul li").eq(e).css({"border-top":"none"})}else i.css("display","none")},error:function(e){console.log(e)}})}function g(){$("#box ul").text(""),o=-(c=1);var e=localStorage.getItem("searchText");if(e){i.css("display","block");let n=JSON.parse(e);var a=n.length;if(a<=cur_max_his){l=a;for(let e=0;e<a;e++){let t=a-e-1;$("#box ul").append("<li><i class='far fa-clock'></i><span>删除</span> "+n[t]+"</li>"),$("#box ul li span").eq(e).click(function(){n.splice(t,1),localStorage.setItem("searchText",JSON.stringify(n)),i.css("display","none"),0<=navigator.userAgent.indexOf("MSIE")&&navigator.userAgent.indexOf("Opera")<0?event.cancelBubble=!0:event.stopPropagation()}),$("#box ul li").eq(e).click(function(){var e=n[t];s.val(e),d(n[t],0),setDelBtn(1),i.css("display","none")})}}else{l=cur_max_his;for(let e=0;e<cur_max_his;e++){let t=cur_max_his-e-1;$("#box ul").append("<li><i class='far fa-clock'></i><span>删除</span> "+n[t]+"</li>"),$("#box ul li span").eq(e).click(function(){n.splice(t,1),localStorage.setItem("searchText",JSON.stringify(n)),i.css("display","none"),0<=navigator.userAgent.indexOf("MSIE")&&navigator.userAgent.indexOf("Opera")<0?event.cancelBubble=!0:event.stopPropagation()}),$("#box ul li").eq(e).click(function(){var e=n[t];s.val(e),d(n[t],0),setDelBtn(1),i.css("display","none")})}}a<=0?i.css("display","none"):($("#box ul").append("<div class='space-tips'><span class='offHistory'>清空历史</span></div>"),$(".offHistory").click(function(){localStorage.removeItem("searchText")}))}else i.css("display","none")}0<localStorage.length&&(null!=(e=JSON.parse(localStorage.getItem("pcEngine")))&&(u.id=e.id,u.name=e.name,u.url=e.url,u.img=e.img,t.css("background-image",u.img)),e=localStorage.getItem("maxHis"),cur_max_his=null!=e?Number(e):10),s.keydown(function(t){$("#search").css("opacity")<1&&$("#search").css("opacity",1);var n=0;if("block"==i.css("display")){if(40===t.keyCode){-1===o&&(r=s.val()),o===(n=0===c?a-1:l-1)?o=-1:o++;let e="";e=-1<o?($("#box ul li").eq(o).addClass("current").siblings().removeClass("current"),p($("#box ul li").eq(o))):($("#box ul li").eq(n).removeClass("current"),r),s.val(e)}if(38===t.keyCode){t.preventDefault&&t.preventDefault(),t.returnValue&&(t.returnValue=!1),-1===o&&(r=s.val()),n=0===c?a-1:l-1,-1===o?o=n:o--;let e="";e=-1<o?($("#box ul li").eq(o).addClass("current").siblings().removeClass("current"),p($("#box ul li").eq(o))):($("#box ul li").eq(0).removeClass("current"),r),s.val(e)}}13===t.keyCode&&((t=s.val())?(d(t,1),o=-1,$("#box ul").html("")):d("",0))}),s.mouseup(function(){"s-txt"==document.activeElement.id&&(s.val()?""==!$.trim(s.val())?(setDelBtn(1),n(s.val())):(setDelBtn(0),$("#box ul").html(""),i.css("display","none")):(setDelBtn(0),g()))}),s.keyup(function(e){"s-txt"==document.activeElement.id&&(s.val()?38!==e.keyCode&&40!==e.keyCode&&(""==!$.trim(s.val())?(setDelBtn(1),n(s.val())):($("#box ul").html(""),setDelBtn(0),i.css("display","none"))):(setDelBtn(0),g()))}),s.blur(function(){setTimeout(function(){i.css("display","none")},250)});for(let e=0;e<searchEngines.length;e++)$(".search-engine-list").append('<li><span style="background-image:'+searchEngines[e].img+'"/></span>'+searchEngines[e].name+"</li>");t.click(function(e){$(".search-engine").toggle(),e.stopPropagation()}),$(document).click(function(){$(".search-engine").hide()}),$(".search-engine-list li").click(function(){var e=$(this).index();u.id=searchEngines[e].id,u.name=searchEngines[e].name,u.url=searchEngines[e].url,u.img=searchEngines[e].img,t.css("background-image",u.img),$(".search-engine").css("display","none"),localStorage.pcEngine=JSON.stringify(u)}),t.css("background-image",u.img),$("#search-btn").click(function(){var e=s.val();e?(d(e,1),$("#box ul").html("")):d("",0)})}window.setDragImageIEPreload=function(e){var t=document.body,n=document.createElement("div");n.style.background='url("'+e.src+'")',n.style.position="absolute",n.style.opacity=.001,t.appendChild(n),setTimeout(function(){t.removeChild(n)},5e3)},"function"!=typeof DataTransfer.prototype.setDragImage&&(DataTransfer.prototype.setDragImage=function(e,t,n){var a,s,i,o="setdragimage-ie-dragging-"+Math.round(Math.random()*Math.pow(10,5))+"-"+Date.now(),e=["."+o,"{",'background: url("'+e.src+'") no-repeat #fff 0 0 !important;',"width: "+e.width+"px !important;","height: "+e.height+"px !important;","text-indent: -9999px !important;","border: 0 !important;","outline: 0 !important;","}","."+o+" * {","display: none !important;","}"],l=document.createElement("style");for(l.innerText=e.join(""),(a=document.getElementsByTagName("head")[0]).appendChild(l),s=DataTransfer.prototype.setDragImage.caller;!(s.arguments[0]instanceof DragEvent);)s=s.caller;(i=s.arguments[0].target).classList.add(o),setTimeout(function(){a.removeChild(l),i.classList.remove(o)},0)}),document.addEventListener("DOMContentLoaded",search);